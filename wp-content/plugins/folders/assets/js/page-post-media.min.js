!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):"undefined"!=typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function($,f){var g,h,i,j=[],k=[],l=-1,m=0,n=0,o="",p=-1,q=0,r="",s=folders_media_options.page_url,t="",u="",v=!1,w=!1,x=!1,y=!1,z=0,A="",B=0,C=[],D=null,E=null,F=wp.media.view.AttachmentFilters.extend({id:"media-attachment-taxonomy-filter",createFilters:function(){var a={};folders_media_options.terms.length,_.each(folders_media_options.terms||{},function(b,c){a[b.term_id]={text:b.name+" ("+b.trash_count+")",props:{media_folder:b.slug}}}),a.all={text:"All Folders",props:{media_folder:""},priority:10},a.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=a},change:function(){var a={};_.each(folders_media_options.terms||{},function(b,c){a[b.term_id]={text:b.name+" ("+b.count+")",props:{media_folder:b.slug}}}),a.all={text:"Select a folder >>",props:{media_folder:""},priority:10},a.unassigned={text:"(Unassigned)",props:{media_folder:"-1"},priority:10},this.filters=a;var b=this.filters[this.el.value];b&&this.model.set(b.props)}}),G=0,H=0,I=[],J=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({createToolbar:function(){J.prototype.createToolbar.call(this),this.toolbar.set("MediaLibraryOrganizerTaxonomyFilter",new F({controller:this.controller,model:this.collection.props,priority:-75}).render())}});var d,e=wp.media.model.Query;_.extend(e,{get:(d=[],function(a,f){var b,c={},g=e.orderby,h=e.defaultProps,i=!1;return delete a.query,delete a.cache,_.defaults(a,h),_.each(["include","exclude"],function(b){a[b]&&!_.isArray(a[b])&&(a[b]=[a[b]])}),_.each(a,function(a,b){_.isNull(a)||(c[e.propmap[b]||b]=a)}),_.defaults(c,e.defaultArgs),c.orderby=g.valuemap[a.orderby]||a.orderby,d=[],b||(b=new e([],_.extend(f||{},{props:a,args:c})),d.push(b)),b})});var a=window.wp;void 0!==a&&"function"==typeof a.Uploader&&(a.media.view.Modal.prototype.on("open",function(){j=[],setTimeout(function(){$("#media-attachment-taxonomy-filter").length&&("all"==$("#media-attachment-taxonomy-filter").val()&&($("#media-attachment-taxonomy-filter option:gt(1)").remove(),_.each(folders_media_options.terms,function(a,b){$("#media-attachment-taxonomy-filter").append("<option value='"+a.term_id+"'>"+a.name+" ("+a.trash_count+")</option>")})),!$("#wcp-content").length&&$(".editor-post-featured-image").length&&$(".attachment-filters").val("all").trigger("change"))},100)}),a.media.view.Modal.prototype.on("close",function(){j=[]}),$.extend(a.Uploader.prototype,{progress:function(){},init:function(){this.uploader&&(this.uploader.bind("FileFiltered",function(a,b){G++,$(".folder-meter").css("width","0%"),$(".media-folder-loader").show(),$("#total_upload_files").text(G)}),this.uploader.bind("BeforeUpload",function(b,e){var a=l,c=b.settings.multipart_params;if((a=parseInt(a))>0&&(c.folder_for_media=a),H<G){$(".media-folder-loader").show();var d=H/G*100;$(".folder-meter").css("width",d+"%")}H++,$("#current_upload_files").text(H)}),this.uploader.bind("UploadComplete",function(a,b){l=-1}),this.uploader.bind("UploadComplete",function(b,c){var a=window.wp;$(".folder-meter").css("width","100%"),setTimeout(function(){$(".media-folder-loader").hide(),$(".folder-meter").css("width","0%"),G=0,H=0},1250),W(),void 0!==a.media.frame&&null!==a.media.frame.content.get()&& void 0!==a.media.frame.content.get().collection&&(j=[],$(".folder-modal ul.attachments li.selected").length&&$(".folder-modal ul.attachments li.selected").each(function(){j.push($(this).data("id"))}),a.media.frame.content.get().collection.props.set({ignore:+new Date}),a.media.frame.content.get().options.selection.reset())}))}}));var c=window.wp;if(void 0!==c&&"function"==typeof c.Uploader){var b=window.wp.media,K=b.view.Modal;b.view.Modal=b.view.Modal.extend({className:"folder-modal",initialize:function(){K.prototype.initialize.apply(this,arguments)},open:function(){K.prototype.open.apply(this,arguments)&&(!$(".folder-modal").length&&$(".supports-drag-drop").length&&$(".supports-drag-drop").each(function(){("block"==$(this).css("display")||"inline-block"==$(this).css("display"))&&$(this).addClass("folder-modal")}),$(".folder-modal").length?($(".folder-custom-menu").remove(),$(".folder-modal .media-frame-tab-panel").removeClass("has-folder-menu"),$(".folder-modal .media-frame").hasClass("hide-menu")?$(".folder-custom-menu").length||($(".folder-modal .media-frame-tab-panel").before("<div class='folder-custom-menu'><div class='folder-menu-content'><div class='cssload-container'><div class='cssload-tube-tunnel'></div></div></div></div>"),$(".folder-modal .folder-menu-content").load(folders_media_options.media_page_url+" #wcp-content-resize",function(){ac(),U(),O()})):$(".folder-custom-menu").length||($(".folder-modal .media-frame-menu").addClass("has-folder-menu"),$(".folder-modal .media-frame-menu .media-menu").append("<div class='folder-custom-menu'><div class='folder-menu-content'><div class='cssload-container'><div class='cssload-tube-tunnel'></div></div></div></div>"),$(".folder-modal .folder-menu-content").load(folders_media_options.media_page_url+" #wcp-content-resize",function(){ac(),U(),O()})),$(".folder-form-data").remove(),$(".media-frame-tab-panel:first").before("<div class='folder-form-data'></div>"),$(".folder-form-data").load(folders_media_options.media_page_url+" #folder-add-update-content",function(){})):setTimeout(function(){-1!=l&&$("#media-attachment-taxonomy-filter").each(function(){$(this).val(l),$(this).trigger("change")})},1e3))},close:function(){K.prototype.close.apply(this,arguments),$(".folder-modal").removeClass("folder-modal")}})}function L(){"yes"==folders_media_options.useFolderUndo&&($("#do-undo").addClass("active"),$(".undo-folder-action").removeClass("disabled"),setTimeout(function(){$("#do-undo").removeClass("active"),$(".undo-folder-action").addClass("disabled")},parseInt(folders_media_options.defaultTimeout)))}function M(){$(".cut-folder-action, .copy-folder-action, .paste-folder-action, .delete-folder-action").addClass("disabled"),$("#js-tree-menu .jstree-anchor.jstree-clicked").length&&$(".delete-folder-action").removeClass("disabled"),($("#menu-checkbox").is(":checked")||$("#menu-checkbox").is(":checked"))&&$("#js-tree-menu input.checkbox:checked").length>0&&$(".delete-folder-action").removeClass("disabled")}function N(){$(".jstree-anchor:not(.ui-droppable)").droppable({accept:".wcp-move-file, .wcp-move-multiple, .attachments-browser li.attachment",hoverClass:"wcp-drop-hover",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(b,a){m=$(this).closest("li.jstree-node").attr("id"),$(this).closest("ul.jstree-container-ul").find(".jstree-clicked").length&&(t=$(this).closest("ul.jstree-container-ul").find(".jstree-clicked").closest("li.jstree-node").attr("id")),a.draggable.hasClass("wcp-move-multiple")?$(".wp-list-table input:checked").length&&(chkStr="",$(".wp-list-table input:checked").each(function(){chkStr+=$(this).val()+","}),r=R(m,"nonce"),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+m+"&nonce="+r+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+t,method:"post",success:function(a){"1"==(a=$.parseJSON(a)).status?(L(),V()):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}})):a.draggable.hasClass("wcp-move-file")?(postID=a.draggable[0].attributes["data-id"].nodeValue,r=R(m,"nonce"),chkStr=postID+",",$(".wp-list-table input:checked").each(function(){$(this).val()!=postID&&(chkStr+=$(this).val()+",")}),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+m+"&nonce="+r+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+t,method:"post",success:function(a){"1"==(a=$.parseJSON(a)).status?(L(),V()):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}})):a.draggable.hasClass("attachment")&&(chkStr=a.draggable[0].attributes["data-id"].nodeValue,r=R(m,"nonce"),$(".attachments-browser li.attachment.selected").length>1&&(chkStr="",$(".attachments-browser li.attachment.selected").each(function(){chkStr+=$(this).data("id")+","})),u=chkStr,$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+m+"&nonce="+r+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+t,method:"post",success:function(a){L(),V(),ae()}}))}}),$(".media-frame:not(.hide-router) .attachments-browser li.attachment:not(.ui-draggable)").draggable({revert:"invalid",containment:"document",helper:function(b,c){$(".selected-items").remove();var a=$(".media-frame:not(.hide-router) .attachments-browser li.attachment.selected").length;return $("<div class='selected-items'><span class='total-post-count'>"+(a=0==a||1==a?"1 Item":a+" Items")+" Selected</span></div>")},start:function(a,b){$("body").addClass("no-hover-css")},cursor:"move",appendTo:".media-modal",cursorAt:{left:0,top:0},stop:function(a,b){$(".selected-items").remove(),$("body").removeClass("no-hover-css")}}),$(".un-categorised-items").droppable({accept:".wcp-move-file, .wcp-move-multiple, .attachments-browser li.attachment",hoverClass:"wcp-hover-list",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(b,a){m=-1,r=folders_media_options.nonce,a.draggable.hasClass("wcp-move-multiple")?$(".wp-list-table input:checked").length&&(chkStr="",$(".wp-list-table input:checked").each(function(){chkStr+=$(this).val()+","}),P(chkStr)):a.draggable.hasClass("wcp-move-file")?(chkStr=(postID=a.draggable[0].attributes["data-id"].nodeValue)+",",$(".wp-list-table input:checked").each(function(){postID!=$(this).val()&&(chkStr+=$(this).val()+",")}),P(chkStr)):a.draggable.hasClass("attachment")&&(chkStr=a.draggable[0].attributes["data-id"].nodeValue,$(".attachments-browser li.attachment.selected").length>1&&(chkStr="",$(".attachments-browser li.attachment.selected").each(function(){chkStr+=$(this).data("id")+","})),u=chkStr,P(chkStr))}}),$(".tree-structure .folder-item:not(.ui-droppable)").droppable({accept:".wcp-move-file, .wcp-move-multiple, .attachments-browser li.attachment",hoverClass:"wcp-drop-hover-list",classes:{"ui-droppable-active":"ui-state-highlight"},drop:function(b,a){$("body").removeClass("no-hover-css"),m=$(this).data("id"),$(this).closest("ul.jstree-container-ul").find(".jstree-clicked").length&&(t=$(this).closest("ul.jstree-container-ul").find(".jstree-clicked").closest("li.jstree-node").attr("id")),a.draggable.hasClass("wcp-move-multiple")?(r=R(m,"nonce"),$(".wp-list-table input:checked").length&&(chkStr="",$(".wp-list-table input:checked").each(function(){chkStr+=$(this).val()+","}),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+m+"&nonce="+r+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+t,method:"post",success:function(a){L(),V(),ae()}}))):a.draggable.hasClass("wcp-move-file")?(postID=a.draggable[0].attributes["data-id"].nodeValue,r=R(m,"nonce"),chkStr=postID+",",$(".wp-list-table input:checked").each(function(){$(this).val()!=postID&&(chkStr+=$(this).val()+",")}),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+m+"&nonce="+r+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+t,method:"post",success:function(a){L(),V(),ae()}})):a.draggable.hasClass("attachment")&&(chkStr=a.draggable[0].attributes["data-id"].nodeValue,r=R(m,"nonce"),$(".attachments-browser li.attachment.selected").length>1&&(chkStr="",$(".attachments-browser li.attachment.selected").each(function(){chkStr+=$(this).data("id")+","})),$.ajax({url:folders_media_options.ajax_url,data:"post_ids="+chkStr+"&type="+folders_media_options.post_type+"&action=wcp_change_multiple_post_folder&folder_id="+m+"&nonce="+r+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+t,method:"post",success:function(a){L(),V(),ae()}}))}}),$(".wcp-move-file:not(.ui-draggable)").draggable({revert:"invalid",containment:"document",helper:"clone",cursor:"move",start:function(a,b){$(this).closest("td").addClass("wcp-draggable"),$("body").addClass("no-hover-css")},stop:function(a,b){$(this).closest("td").removeClass("wcp-draggable"),$("body").removeClass("no-hover-css")}}),$(".wcp-move-multiple:not(.ui-draggable)").draggable({revert:"invalid",containment:"document",helper:function(a,b){return($(".selected-items").remove(),(selectedItems=$("#the-list th input:checked").length)>0)?$("<div class='selected-items'><span class='total-post-count'>"+(selectedItems=0==selectedItems||1==selectedItems?"1 Item":selectedItems+" Items")+" Selected</span></div>"):$("<div class='selected-items'><span class='total-post-count'>Select Items to move</span></div>")},start:function(a,b){$("body").addClass("no-hover-css")},cursor:"move",cursorAt:{left:0,top:0},stop:function(a,b){$(".selected-items").remove(),$("body").removeClass("no-hover-css")}})}function O(){$(".folder-modal #js-tree-menu").jstree({core:{cache:!1,animation:0,max_depth:h?"-1":1,check_callback:function(b,c,d,e,a){if($("*").removeClass("drag-bot").removeClass("drag-in").removeClass("drag-up"),("move_node"===b||"copy_node"===b)&&a&&a.dnd)switch(a.pos){case"a":a.origin.get_node(a.ref,!0).addClass("drag-bot"),nodeId=$(".drag-bot").attr("id"),$("#jstree-dnd").text("Below "+$.trim($("#js-tree-menu").jstree(!0).get_node(nodeId).text));break;case"i":if(!h&&$("#do_not_show_again").is(":checked"))return!1;a.origin.get_node(a.ref,!0).addClass("drag-in"),nodeId=$(".drag-in").attr("id"),$("#jstree-dnd").text("Inside "+$.trim($("#js-tree-menu").jstree(!0).get_node(nodeId).text));break;case"b":a.origin.get_node(a.ref,!0).addClass("drag-up"),nodeId=$(".drag-up").attr("id"),$("#jstree-dnd").text("Above "+$.trim($("#js-tree-menu").jstree(!0).get_node(nodeId).text));break;default:$("#jstree-dnd").text($("#jstree-dnd").data("txt"))}return!0}},data:{cache:!1},select_node:!1,search:{show_only_matches:!0,case_sensitive:!1,fuzzy:!1},plugins:["dnd","search","contextmenu"],contextmenu:{select_node:0,show_at_node:0,items:function(){return{}}}}).bind("ready.jstree",function(){if(Q(),N(),""!=folders_media_options.default_folder&&0!=folders_media_options.default_folder){var a=getFolderIDFromSlug(folders_media_options.default_folder);""!=a&&$(".folder-modal #media-attachment-taxonomy-filter option[value='"+a+"']").length&&($(".folder-modal #media-attachment-taxonomy-filter").val(a).trigger("change"),$(".folder-modal #js-tree-menu .jstree-clicked").removeClass("jstree-clicked"),$(".folder-modal #js-tree-menu").jstree("select_node",a),$(".folder-modal #js-tree-menu .jstree-node[id='"+a+"'] > a").addClass("jstree-clicked"))}}).bind("after_open.jstree",function(){N()}).bind("open_all.jstree",function(){N()}).bind("create_node.jstree",function(){N()}).bind("delete_node.jstree",function(){N()}).bind("close_all.jstree",function(){N()}).bind("after_close.jstree",function(){N()}).bind("move_node.jstree",function(d,a){if(!h){var b=a.old_position,c=a.parent;if("#"!=c)return $("#js-tree-menu").jstree("move_node","#"+a.node.id,"#",b),$("#sub-drag-folder-popup").show(),!1}"#"!=a.node.parent&&jQuery("#js-tree-menu").jstree("open_node",a.node.parent),folderMoveId=a.node.id,orderString="",$(".folder-modal .jstree-node[id='"+folderMoveId+"']").closest("ul").children().each(function(){"undefined"!=$(this).attr("id")&&(orderString+=$(this).attr("id")+",")}),parentID=$(".folder-modal #"+folderMoveId+"_anchor").closest(".jstree-node").parent().parent().hasClass("jstree-node")?$("#"+folderMoveId+"_anchor").closest(".jstree-node").parent().parent().attr("id"):0,""!=orderString&&($(".form-loader-count").css("width","100%"),$.ajax({url:folders_media_options.ajax_url,data:"term_ids="+orderString+"&action=wcp_save_folder_order&type="+folders_media_options.post_type+"&nonce="+folders_media_options.nonce+"&term_id="+folderMoveId+"&parent_id="+parentID,method:"post",success:function(a){"1"==(a=$.parseJSON(a)).status?($("#wcp_folder_parent").html(a.options),$(".form-loader-count").css("width","0"),V(),ae(),X(),N()):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show(),window.location.reload(!0))}}))}),N()}function P(a){$(".folder-modal #js-tree-menu .jstree-anchor.jstree-clicked").length?(t=$(".folder-modal #js-tree-menu .jstree-anchor.jstree-clicked").closest(".jstree-node").attr("id"),$.ajax({url:folders_media_options.ajax_url,data:{post_id:a,action:"premio_check_for_other_folders",active_folder:t,type:folders_media_options.post_type,folder_id:-1,nonce:folders_media_options.nonce,status:folders_media_options.taxonomy_status,taxonomy:t},method:"post",success:function(a){-1==(a=$.parseJSON(a)).status?($("#unassigned_folders").val(a.data.post_id),$("#confirm-your-change").show()):(V(),L())}})):(r=folders_media_options.nonce,$.ajax({url:folders_media_options.ajax_url,data:"post_id="+a+"&type="+folders_media_options.post_type+"&action=wcp_remove_post_folder&folder_id=-1&nonce="+r+"&status="+folders_media_options.taxonomy_status+"&taxonomy="+t,method:"post",success:function(a){V(),L()}}))}function Q(){$("#js-tree-menu .jstree-node").each(function(){var a=$(this).data("count")&&""!=$(this).data("count")?$(this).data("count"):0;$(".jstree-node[id='"+$(this).attr("id")+"'] > a span.premio-folder-count").text(a)}),$("span.premio-folder-count").each(function(){""==$(this).text()&&$(this).text(0)}),""!=t&&0!=t&&$(".jstree-node[id='"+t+"']").length&&($("#js-tree-menu").jstree("select_node",t),$(".sticky-folders .sticky-folder-"+t+" a").length&&$(".sticky-folders .sticky-folder-"+t+" a").addClass("active-item")),$(".ajax-preloader").hide(),$(".js-tree-data").show(),U(),T(),$(".sticky-folders ul > li").length>0&&$(".sticky-folders").addClass("active")}function R(a,b){if(k.length>0){for(i=0;i<k.length;i++)if(parseInt(k[i].folder_id)==parseInt(a))return k[i][b]}return""}function S(a){if(k.length>0){for(i=0;i<k.length;i++)if(parseInt(k[i].folder_id)==parseInt(a))return i}return null}function T(){$(".sticky-folders > ul").html("");var a="";if($("#js-tree-menu li.jstree-node.is-sticky").each(function(){var b=$(this).attr("id"),c=$.trim($("#js-tree-menu").jstree(!0).get_node(b).text),d=$("li.jstree-node[id='"+b+"'] > a span.premio-folder-count").text(),e=$("li.jstree-node[id='"+b+"']").hasClass("is-high")?" is-high ":"";a+="<li data-folder-id='"+b+"' class='sticky-fldr "+e+" sticky-folder-"+b+"'><a href='javascript:;'><span class='folder-title'>"+c+"</span><span class='folder-actions'><span class='update-inline-record'><i class='pfolder-edit-folder'></i></span><span class='star-icon'><i class='pfolder-star'></i></span><span class='premio-folder-count'>"+d+"</span></span></a></li>"}),$(".sticky-folders > ul").html(a),$(".jstree-anchor.jstree-clicked").length){var b=$(".jstree-anchor.jstree-clicked").closest("li.jstree-node").attr("id");$(".sticky-folders .sticky-folder-"+b+" a").addClass("active-item")}$(".sticky-folders > ul > li").length>0?$(".sticky-folders").addClass("active"):$(".sticky-folders").removeClass("active")}function U(){var c=0;if($("#custom-scroll-menu").hasClass("mCustomScrollbar")){var a=jQuery("#custom-scroll-menu"),d=a.find(".mCSB_dragger"),e=a.find(".mCSB_container").height();c=d.position().top/(a.height()-d.height())*(e-a.height()),$("#custom-scroll-menu").mCustomScrollbar("destroy")}var b=jQuery(".folder-modal .media-modal-content").height()-$(".folder-modal .sticky-wcp-custom-form").height()-40;$(".folder-modal #custom-scroll-menu").closest(".media-frame-menu").length&&jQuery(".folder-custom-menu").length&&jQuery(".media-frame-menu").length&&(b=jQuery(".folder-modal .media-modal-content").height()-$(".folder-modal .sticky-wcp-custom-form").height()-jQuery(".folder-custom-menu").offset().top+jQuery(".media-frame-menu").offset().top-40),b<0&&(b=350),$("#custom-scroll-menu").mCustomScrollbar({axis:"y",scrollButtons:{enable:!0},setHeight:b,theme:"3d",scrollbarPosition:"inside",scrollInertia:500,mouseWheelPixels:60}),0!=c&&jQuery("#custom-scroll-menu").mCustomScrollbar("scrollTo",c+"px",{scrollInertia:0})}function V(){if($(".media-toolbar").hasClass("media-toolbar-mode-select")&&$("ul.attachments li.selected").length&&($("ul.attachments li.selected").trigger("click"),$(".select-mode-toggle-button").trigger("click")),""!=u&&($("#js-tree-menu a.jstree-clicked").length>0||"-1"==t)){if($("#media-attachment-taxonomy-filter").length){u=u.split(",");for(var a=0;a<u.length;a++)""!=u[a]&&$(".attachments-browser li[data-id='"+u[a]+"']").remove()}u=""}$("#media-attachment-taxonomy-filter").length?ad(0):($.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=get_folders_default_list",method:"post",success:function(a){a=$.parseJSON(a),$(".header-posts .total-count").text(a.total_items),$(".un-categorised-items .total-count").text(a.empty_items),C=a.taxonomies,X(),N()}}),$(".folder-loader-ajax").addClass("active"),$("#folder-posts-filter").length?$("#folder-posts-filter").load(s+" #posts-filter",function(){var a={Title:"",Url:s};history.pushState(a,a.Title,a.Url),"show"!=folders_media_options.show_in_page||$(".tree-structure").length||$(".wp-header-end").before('<div class="tree-structure-content"><div class="tree-structure"><ul></ul><div class="clear clearfix"></div></div></div>'),triggerInlineUpdate()}):$("#wpbody").load(s+" #wpbody-content",!1,function(b){var a={Title:"",Url:s};history.pushState(a,a.Title,a.Url),"show"!=folders_media_options.show_in_page||$(".tree-structure").length||$(".wp-header-end").before('<div class="tree-structure-content"><div class="tree-structure"><ul></ul><div class="clear clearfix"></div></div></div>')}))}function W(){$("#media-attachment-taxonomy-filter").val(),i=$.ajax({url:folders_media_options.ajax_url,data:"type=attachment&action=wcp_get_default_list&active_id=0",method:"post",beforeSend:function(){null!=i&&i.abort()},success:function(a){var a=$.parseJSON(a);C=a.taxonomies,X(),N()}})}function X(){if($("#media-attachment-taxonomy-filter").length&&($("#media-attachment-taxonomy-filter").each(function(){folders_media_options.terms=C;var b=$(this);currentDDVal=$(this).val(),b.html("<option value='all'>All Folders</option><option value='unassigned'>(Unassigned)</option>"),I=C;for(var a=0;a<C.length;a++)b.append("<option value='"+C[a].term_id+"'>"+C[a].name+" ("+C[a].trash_count+")</option>");b.val(currentDDVal).trigger("change")}),$("select.folder_for_media").length)){var b=$("select.folder_for_media").val();$("select.folder_for_media option:not(:first-child):not(:last-child)").remove();for(var a=0;a<C.length;a++)$("select.folder_for_media option:last-child").before("<option value='"+C[a].term_id+"'>"+C[a].name+"</option>");""!=b&&$(".folder_for_media").val(b)}for($("span.premio-folder-count").text(""),$(".folder-count").text(""),a=0;a<C.length;a++)$(".jstree-node[id='"+C[a].term_id+"'] > a.jstree-anchor span.premio-folder-count").text(C[a].trash_count),$(".sticky-folder-"+C[a].term_id+" .premio-folder-count").text(C[a].trash_count);$("span.premio-folder-count").each(function(){""==$(this).text()&&$(this).text(0)}),""!=t&&$("#wcp_folder_"+t).addClass("active-item"),w&&($("#title_"+n).trigger("click"),w=!1)}function Y(){var a=$.trim($("#folder-search").val());$("#js-tree-menu").jstree("search",a)}function Z(c){var a="Are you sure you want to delete the selected folder?",b="Items in the folder will not be deleted.";if(v=!1,1==c&&$("#menu-checkbox").is(":checked")){if(v=!0,0==$("#js-tree-menu input.checkbox:checked").length){$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html("Please select at least one folder to delete"),$("#error-folder-popup").show();return}$("#js-tree-menu input.checkbox:checked").length>1&&(a="Are you sure you want to delete the selected folders?",b="Items in the selected folders will not be deleted.")}$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#remove-folder-item").text("Yes, Delete it!"),$("#remove-folder-message").text(a),$("#remove-folder-notice").text(b),$("#confirm-remove-folder").show(),$("#remove-folder-item").focus()}function aa(){folderName=$.trim($("#js-tree-menu").jstree(!0).get_node(n).text),parentID=$("#wcp_folder_"+n).closest("li.jstree-node").data("folder-id"),parentID==f&&(parentID=0),$("#update-folder-data").text("Submit"),$(".folder-form-errors").removeClass("active"),$("#update-folder-item-name").val(folderName),$("#update-folder-item").removeClass("disabled"),$("#update-folder-item").show(),$("#update-folder-item-name").focus(),$(".dynamic-menu").remove()}function ab(){if(0==q&&p>=10)return $("#folder-limitation-message").html("You've reached the 10 folder limitation!"),$("#no-more-folder-credit").show(),!1;$("#add-update-folder-title").text("Add new folder"),$("#save-folder-data").text("Submit"),$(".folder-form-errors").removeClass("active"),$("#add-update-folder-name").val(""),x&&(z=n,$("#add-update-folder-name").val($.trim($("#js-tree-menu").jstree(!0).get_node(n).text)+" #2"),n=$("#"+n+"_anchor").closest(".jstree-node").parent().parent().hasClass("jstree-node")?$("#"+n+"_anchor").closest(".jstree-node").parent().parent().attr("id"):0),$("#add-update-folder").removeClass("disabled"),$("#add-update-folder").show(),$("#add-update-folder-name").focus(),$(".dynamic-menu").remove()}function ac(){setTimeout(function(){if($("#js-tree-menu .jstree-node.jstree-leaf").length==$("#js-tree-menu .jstree-node").length)$("#expand-collapse-list").removeClass("all-open"),$("#expand-collapse-list").attr("data-folder-tooltip","Expand");else{var a=$("#js-tree-menu .jstree-node.jstree-closed").length+$("#js-tree-menu .jstree-node.jstree-open").length;$("#js-tree-menu .jstree-node.jstree-closed").length==a?($("#expand-collapse-list").removeClass("all-open"),$("#expand-collapse-list").attr("data-folder-tooltip","Expand")):($("#expand-collapse-list").addClass("all-open"),$("#expand-collapse-list").attr("data-folder-tooltip","Collapse"))}},500),N()}function ad(a){i=$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_get_default_list&active_id="+t,method:"post",beforeSend:function(){null!=i&&i.abort()},success:function(c){if(c=$.parseJSON(c),$(".header-posts .total-count").text(c.total_items),$(".un-categorised-items .total-count").text(c.empty_items),selectedVal=$("#media-attachment-taxonomy-filter").val(),"all"!=selectedVal&&1==a){var b=parent.wp;f!=b.media&&(b.media.frame.setState("insert"),null!==b.media.frame.content.get()&& void 0!==b.media.frame.content.get().collection?(b.media.frame.content.get().collection.props.set({ignore:+new Date}),b.media.frame.content.get().options.selection.reset()):b.media.frame.library.props.set({ignore:+new Date}))}C=c.taxonomies,X(),N()}})}function ae(){$(".folder-loader-ajax").addClass("active"),$(".folder-loader-ajax img").removeClass("active"),$(".folder-loader-ajax svg#successAnimation").addClass("active").addClass("animated"),setTimeout(function(){$(".folder-loader-ajax").removeClass("active"),$(".folder-loader-ajax img").addClass("active"),$(".folder-loader-ajax svg#successAnimation").removeClass("active").removeClass("animated")},2e3),N()}$(document).ready(function(){$(document).on("click",".folder-settings-btn > a",function(a){a.stopPropagation(),$(".folder-settings-btn").toggleClass("active")}),$(document).on("click","body,html",function(){$(".folder-settings-btn").removeClass("active")}),$(document).on("click",".folder-setting-menu",function(a){a.stopPropagation()}),$(document).on("click","#remove-from-all-folders:not(.disabled), #remove-from-current-folder:not(.disabled)",function(){$("#remove-from-all-folders, #remove-from-current-folder").addClass("disabled");var a="all";$(this).hasClass("remove-from-current-folder")&&(a="current"),$("#confirm-your-change").hide(),$.ajax({url:folders_media_options.ajax_url,data:{post_id:$("#unassigned_folders").val(),action:"wcp_remove_post_folder",active_folder:t,type:folders_media_options.post_type,folder_id:-1,nonce:folders_media_options.nonce,status:folders_media_options.taxonomy_status,taxonomy:t,remove_from:a},method:"post",success:function(a){$("#remove-from-all-folders, #remove-from-current-folder").removeClass("disabled"),ae(),V(),L()}})}),g=parseInt(folders_media_options.hasStars),h=parseInt(folders_media_options.hasChildren),$(document).on("click",".thumbnail-hover-box a",function(a){return a.stopPropagation(),a.stopImmediatePropagation(),a.preventDefault(),window.open($(this).prop("href"),"_blank"),!1}),$(document).ajaxComplete(function(d,e,b){if(f!=b.data&&""!=b.data&&"string"==typeof b.data&& -1!=b.data.indexOf("action=query-attachments")&&N(),j.length>0){for(var a=0;a<j.length;a++)if(jQuery(".folder-modal ul.attachments li[data-id='"+j[a]+"']").length&&!jQuery(".folder-modal ul.attachments li[data-id='"+j[a]+"']").hasClass("selected")){var c=jQuery.Event("click");c.ctrlKey=!0,jQuery(".folder-modal ul.attachments li[data-id='"+j[a]+"']").trigger(c)}}}),C=folders_media_options.terms,q=parseInt(folders_media_options.is_key_active),p=parseInt(folders_media_options.folders),k=folders_media_options.folder_settings,$(document).on("click",".header-posts a.all-posts",function(a){n=0,t="",l="all",$(".active-item").removeClass("active-item"),$(".jstree-clicked").removeClass("jstree-clicked"),$(this).addClass("active-item"),$(".sticky-folders .active-item").removeClass("active-item"),$(this).closest(".media-frame").find("#media-attachment-taxonomy-filter").val("all").trigger("change"),$(this).closest(".media-frame").find(".folder_for_media").val("all").trigger("change"),M()}),$(document).on("click",".un-categorised-items",function(a){n=0,t="",l="unassigned",$(".active-item").removeClass("active-item"),$(".sticky-folders .active-item").removeClass("active-item"),$(".jstree-clicked").removeClass("jstree-clicked"),$(this).addClass("active-item"),$(this).closest(".media-frame").find("#media-attachment-taxonomy-filter").val("unassigned").trigger("change"),$(this).closest(".media-frame").find(".folder_for_media").val("-1").trigger("change"),M()}),$(document).on("click","a.jstree-anchor",function(c){var b,a=$(this).closest("li.jstree-node").attr("id");l=n=a,$(this).closest(".folder-modal").find(".active-item").removeClass("active-item"),$(this).closest(".folder-modal").find("#media-attachment-taxonomy-filter").val(a),$(this).closest(".folder-modal").find("#media-attachment-taxonomy-filter").trigger("change"),b=thisSlug=R(a,"slug"),$.ajax({url:folders_media_options.ajax_url,type:"post",data:"action=save_folder_last_status&post_type="+folders_media_options.post_type+"&post_id="+b+"&nonce="+folders_media_options.nonce,cache:!1,async:!1,success:function(){}}),$(".custom-media-select").removeClass("active"),$(".folder-modal #js-tree-menu .jstree-clicked").removeClass("jstree-clicked"),$(".folder-modal #js-tree-menu").jstree("select_node",t),$(".folder-modal #js-tree-menu #"+l+"_anchor").addClass("jstree-clicked"),M()}),$(document).on("change",".folder_for_media",function(){"add-folder"!=$(this).val()&&null!=$(this).val()?l=$(this).val():"add-folder"==$(this).val()&&(l=-1)}),$(document).on("click",".new-folder-pro",function(a){a.preventDefault(),$(".dynamic-menu").remove(),$("#sub-folder-popup").show()}),$(document).on("click",".close-popup-button a",function(){$(".folder-popup-form").hide(),$(".folder-modal .jstree-node[id='"+n+"']").length?$(".folder-modal .jstree-node[id='"+n+"'] > a.jstree-anchor").trigger("focus"):$(".folder-modal .jstree-anchor.jstree-clicked").length&&$(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus")}),$(document).on("click",".update-inline-record",function(a){var b;a.stopImmediatePropagation(),a.stopPropagation(),0!=folders_media_options.can_manage_folder&&(isHigh=$(this).closest("li.sticky-fldr").hasClass("is-high"),isSticky=$(this).closest("li.sticky-fldr").hasClass("is-sticky"),isStickyClass=!!isSticky,$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),menuHtml="<div class='dynamic-menu' data-id='"+$(this).closest("li").data("folder-id")+"'><ul>",menuHtml+="<li class='new-main-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Folder</a></li>",h?menuHtml+="<li class='new-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Folder</a></li>":menuHtml+="<li class='new-folder-pro'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Sub-folder (Pro)</a></li>",menuHtml+="<li class='rename-folder'><a href='javascript:;'><span class=''><i class='pfolder-edit'></i></span>Rename</a></li><li class='default-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-active-icon'></i></span>Open this folder by default (Pro)</a></li><li class='sticky-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='sticky-pin'><i class='pfolder-pin'></i></span>Sticky Folder (Pro)</a></li>",g?menuHtml+="<li class='mark-folder'><a href='javascript:;'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?"Remove Star":"Add a Star")+"</a></li>":menuHtml+="<li class='mark-folder-pro'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?"Remove Star (Pro)":"Add a Star (Pro)")+"</a></li>",menuHtml+="<li class='lock-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='dashicons dashicons-lock'></span>Lock Folder (Pro)</a></li><li class='duplicate-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-clone'></i></span>Duplicate folder (Pro)</a></li>",hasPosts=parseInt($(this).closest("li.jstree-node").find("h3.title:first > .total-count").text()),"attachment"==folders_media_options.post_type&&hasPosts&&(menuHtml+="<li class='download-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-zip-file'></i></span>Download Zip (Pro)</a></li>"),menuHtml+="<li class='remove-folder'><a href='javascript:;'><span class=''><i class='pfolder-remove'></i></span>Delete</a></li></ul></div>",$("body").append(menuHtml),f==a.pageX||f==a.pageY?($(".dynamic-menu").css("left",D),$(".dynamic-menu").css("top",E-10),b=E):($(".dynamic-menu").css("left",a.pageX),$(".dynamic-menu").css("top",a.pageY),b=a.pageY),b+$(".dynamic-menu").height()>$(window).height()&&$(".dynamic-menu").css("margin-top",$(window).height()-(b+$(".dynamic-menu").height())))}),$(document).on("click","body, html",function(a){$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),$(".folder-order").removeClass("active")}),$(document).on("click",".dynamic-menu, .folder-order",function(a){a.stopPropagation()}),$(document).on("contextmenu",".jstree-anchor",function(a){return D=a.pageX,E=a.pageY,$(this).find("span.folder-inline-edit").trigger("click"),!1}),$(document).on("click",".folder-actions span.folder-inline-edit",function(a){var b;a.stopImmediatePropagation(),a.stopPropagation(),0!=folders_media_options.can_manage_folder&&(isHigh=$(this).closest("li.jstree-node").hasClass("is-high"),isSticky=$(this).closest("li.jstree-node").hasClass("is-sticky"),isStickyClass=!!isSticky,$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),menuHtml="<div class='dynamic-menu' data-id='"+$(this).closest("li").prop("id")+"'><ul>",menuHtml+="<li class='new-main-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Folder</a></li>",h?menuHtml+="<li class='new-folder'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Folder</a></li>":menuHtml+="<li class='new-folder-pro'><a href='javascript:;'><span class=''><i class='pfolder-add-folder'></i></span>New Sub-folder (Pro)</a></li>",menuHtml+="<li class='rename-folder'><a href='javascript:;'><span class=''><i class='pfolder-edit'></i></span>Rename</a></li><li class='default-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-active-icon'></i></span>Open this folder by default (Pro)</a></li><li class='sticky-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='sticky-pin'><i class='pfolder-pin'></i></span>Sticky Folder (Pro)</a></li>",g?menuHtml+="<li class='mark-folder'><a href='javascript:;'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?"Remove Star":"Add a Star")+"</a></li>":menuHtml+="<li class='mark-folder-pro'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-star'></i></span>"+(isHigh?"Remove Star (Pro)":"Add a Star (Pro)")+"</a></li>",menuHtml+="<li class='lock-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class='dashicons dashicons-lock'></span>Lock Folder (Pro)</a></li><li class='duplicate-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-clone'></i></span>Duplicate folder (Pro)</a></li>",hasPosts=parseInt($(this).closest("a.jstree-anchor").find(".premio-folder-count").text()),"attachment"==folders_media_options.post_type&&hasPosts&&(menuHtml+="<li class='download-folder'><a target='_blank' href='"+folders_media_options.upgrade_url+"'><span class=''><i class='pfolder-zip-file'></i></span>Download Zip (Pro)</a></li>"),menuHtml+="<li class='remove-folder'><a href='javascript:;'><span class=''><i class='pfolder-remove'></i></span>Delete</a></li></ul></div>",$("body").append(menuHtml),$(this).parents("li.jstree-node").addClass("active-menu"),f==a.pageX||f==a.pageY?($(".dynamic-menu").css("left",D),$(".dynamic-menu").css("top",E-10),b=E):($(".dynamic-menu").css("left",a.pageX),$(".dynamic-menu").css("top",a.pageY),b=a.pageY),b+$(".dynamic-menu").height()>$(window).height()&&$(".dynamic-menu").css("margin-top",$(window).height()-(b+$(".dynamic-menu").height())))}),$(document).on("click",".dynamic-menu",function(a){a.stopImmediatePropagation(),a.stopPropagation()}),$(document).on("click","body, html",function(){$(".dynamic-menu").remove()}),$(document).on("click",".new-folder",function(a){a.stopPropagation(),n=$(this).closest(".dynamic-menu").data("id"),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),w=!1,x=!1,ab()}),$(document).on("click",".new-main-folder",function(){y=1,n=$(this).closest(".dynamic-menu").data("id"),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),w=!1,x=!1,ab()}),$(document).on("click","#add-new-folder",function(a){$("#js-tree-menu a.jstree-clicked").length?(n=$("#js-tree-menu a.jstree-clicked").closest("li.jstree-node").attr("id"),h||$("#pro-notice").removeClass("hide-it")):(n=0,$("#pro-notice").addClass("hide-it")),w=!1,ab()}),$(document).on("submit","#save-folder-form",function(b){if(b.stopPropagation(),b.preventDefault(),o=$("#add-update-folder-name").val(),""==$.trim(o))$(".folder-form-errors").addClass("active"),$("#add-update-folder-name").focus();else{$("#save-folder-data").html('<span class="dashicons dashicons-update"></span>'),$("#add-update-folder").addClass("disabled");var a=n;w&&(a=0),h||(a=0);var c="";0==a?(B=$("#js-tree-menu > ul > li.jstree-node").length,y&&(B=jQuery("#js-tree-menu > ul > li[id='"+n+"']").index(),jQuery("#js-tree-menu > ul > li").each(function(a){c+=jQuery(this).attr("id")+",",a==B&&(c+="#,")}),B+=1)):B=$("#js-tree-menu > ul > li.jstree-node[id='"+a+"'] > ul.jstree-children > li").length+1,$.ajax({url:folders_media_options.ajax_url,data:{parent_id:a,type:folders_media_options.post_type,action:"wcp_add_new_folder",nonce:folders_media_options.nonce,term_id:a,order:B,name:o,is_duplicate:x,duplicate_from:z,parent_ids:c,parent_menu:y},method:"post",success:function(c){if(result=$.parseJSON(c),$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),-1==result.status)$("#no-more-folder-credit").show();else if("1"==result.status){if(q=parseInt(result.is_key_active),p=parseInt(result.folders),$("#current-folder").text(p),$("#ttl-fldr").text(10),ac(),result.data.length)for(var a=0;a<result.data.length;a++){var b={folder_id:result.data[a].term_id,folder_count:0,is_sticky:result.data[a].is_sticky,is_high:result.data[a].is_high,nonce:result.data[a].nonce,slug:result.data[a].slug,is_deleted:0};k.push(b),k.push(b),y?$("#js-tree-menu").jstree().create_node("#",{id:result.data[a].term_id,text:" "+result.data[a].title},B,function(){$(".jstree-node[id='"+result.data[a].term_id+"']").attr("data-nonce",result.data[a].nonce),$(".jstree-node[id='"+result.data[a].term_id+"']").attr("data-slug",result.data[a].slug),$(".jstree-node[id='"+result.data[a].term_id+"'] > a.jstree-anchor .premio-folder-count").text(0)}):$("#js-tree-menu").jstree().create_node(result.parent_id,{id:result.data[a].term_id,text:" "+result.data[a].title},"last",function(){$(".jstree-node[id='"+result.data[a].term_id+"']").attr("data-nonce",result.data[a].nonce),$(".jstree-node[id='"+result.data[a].term_id+"']").attr("data-slug",result.data[a].slug),$(".jstree-node[id='"+result.data[a].term_id+"'] > a.jstree-anchor .premio-folder-count").text(0)}),y=0,$(".jstree-node[id='"+result.data[a].term_id+"']").length&&$(".jstree-node[id='"+result.data[a].term_id+"'] > a.jstree-anchor").trigger("focus")}ae(),T(),n=result.term_id,ad(0),x=!1,z=0}else $("#error-folder-popup-message").html(result.message),$("#error-folder-popup").show()}})}return!1}),$(document).on("click",".form-cancel-btn",function(){$(".folder-popup-form").hide(),$(".folder-modal .jstree-node[id='"+n+"']").length?$(".folder-modal .jstree-node[id='"+n+"'] > a.jstree-anchor").trigger("focus"):$(".folder-modal .jstree-anchor.jstree-clicked").length&&$(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus")}),$(document).on("click",".folder-popup-form",function(a){$(".folder-popup-form").hide(),$(".folder-modal .jstree-node[id='"+n+"']").length?$(".folder-modal .jstree-node[id='"+n+"'] > a.jstree-anchor").trigger("focus"):$(".folder-modal .jstree-anchor.jstree-clicked").length&&$(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus")}),$(document).on("click",".popup-form-content",function(a){a.stopPropagation()}),document.onkeydown=function(a){a=a||window.event;("key"in a?"Escape"===a.key||"Esc"===a.key:27===a.keyCode)&&$(".folder-popup-form").hide()},$(document).on("click",".rename-folder",function(a){a.stopPropagation(),n=$(this).closest(".dynamic-menu").data("id"),aa(),$(".dynamic-menu").remove()}),$(document).on("click","#inline-update",function(a){$("#js-tree-menu a.jstree-clicked").length&&(n=$("#js-tree-menu a.jstree-clicked").closest("li.jstree-node").attr("id"),aa())}),$(document).on("submit","#update-folder-form",function(a){return a.stopPropagation(),a.preventDefault(),o=$("#update-folder-item-name").val(),""==$.trim(o)?($(".folder-form-errors").addClass("active"),$("#update-folder-item-name").focus()):($("#update-folder-data").html('<span class="dashicons dashicons-update"></span>'),$("#update-folder-item").addClass("disabled"),r=R(n,"nonce"),f==(parentID=$(".jstree-node[id='"+n+"']").closest("li.jstree-node").attr("id"))&&(parentID=0),$.ajax({url:folders_media_options.ajax_url,data:{parent_id:parentID,type:folders_media_options.post_type,action:"wcp_update_folder",nonce:r,term_id:n,order:B,name:o},method:"post",success:function(a){"1"==(result=$.parseJSON(a)).status?($("#js-tree-menu").jstree("rename_node",result.id," "+result.term_title),null!=(folderPostId=S(result.id))&&(k[folderPostId].nonce=result.nonce,k[folderPostId].slug=result.slug),$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),ae(),$("#media-attachment-taxonomy-filter").length&&ad(0),$(".folder-modal .jstree-node[id='"+result.id+"']").length?$(".folder-modal .jstree-node[id='"+result.id+"'] > a.jstree-anchor").trigger("focus"):$(".folder-modal .jstree-anchor.jstree-clicked").length&&$(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus")):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(result.message),$("#error-folder-popup").show())}})),!1}),$(document).on("click",".mark-folder",function(a){a.stopPropagation(),r=R(m=$(this).closest(".dynamic-menu").data("id"),"nonce"),$(".form-loader-count").css("width","100%"),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"),$.ajax({url:folders_media_options.ajax_url,data:"term_id="+m+"&type="+folders_media_options.post_type+"&action=wcp_mark_un_mark_folder&nonce="+r,method:"post",cache:!1,success:function(a){a=$.parseJSON(a),$(".form-loader-count").css("width","0%"),"1"==a.status?(folderPostId=S(a.id),"1"==a.marked?($("li.jstree-node[id='"+a.id+"']").addClass("is-high"),$(".sticky-folder-"+a.id).addClass("is-high"),null!=folderPostId&&(k[folderPostId].is_high=1)):($("li.jstree-node[id='"+a.id+"']").removeClass("is-high"),$(".sticky-folder-"+a.id).removeClass("is-high"),null!=folderPostId&&(k[folderPostId].is_high=0)),$(".folder-modal .jstree-node[id='"+a.id+"']").length?$(".folder-modal .jstree-node[id='"+a.id+"'] > a.jstree-anchor").trigger("focus"):$(".folder-modal .jstree-anchor.jstree-clicked").length&&$(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus"),ae()):($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show())}})}),$(document).on("click",".duplicate-folder",function(a){a.stopPropagation(),n=$(this).closest(".dynamic-menu").data("id"),$(".dynamic-menu").remove(),w=!1,x=!0,ab()}),$(document).on("click",".remove-folder",function(){m=$(this).closest(".dynamic-menu").data("id"),n=$(this).closest(".dynamic-menu").data("id"),Z(0),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu")}),$(document).on("click","#remove-folder-item",function(a){a.stopPropagation(),$(".folder-popup-form").addClass("disabled"),$("#remove-folder-item").html('<span class="dashicons dashicons-update"></span>'),r=R(n,"nonce"),v?function(){if($("#menu-checkbox").is(":checked")&&$("#js-tree-menu input.checkbox:checked").length>0){var a="",b=!1;$("#js-tree-menu input.checkbox:checked").each(function(){a+=$(this).closest("li.jstree-node").attr("id")+",",$(this).closest("li.jstree-node").hasClass("jstree-clicked")&&(b=!0)}),$(".form-loader-count").css("width","100%"),$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_remove_muliple_folder&term_id="+a+"&nonce="+folders_media_options.nonce,method:"post",success:function(a){if(a=$.parseJSON(a),$(".form-loader-count").css("width","0px"),"1"==a.status){for(q=parseInt(a.is_key_active),p=parseInt(a.folders),$("#current-folder").text(p),i=0;i<a.term_ids.length;i++)$(".folder-modal #js-tree-menu").jstree().delete_node(a.term_ids[i]);$("#ttl-fldr").text(10),ae(),$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),V(),T(),ae(),$(".folder-modal #wcp_folder_"+t).length||($(".header-posts a").trigger("click"),t=0)}else window.location.reload();$("#menu-checkbox").attr("checked",!1),$("#js-tree-menu input.checkbox").attr("checked",!1),$("#js-tree-menu").removeClass("show-folder-checkbox")}})}}():$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_remove_folder&term_id="+n+"&nonce="+r,method:"post",success:function(b){if("1"==(b=$.parseJSON(b)).status){var a,c=$(".jstree-node[id='"+(a=n)+"']").next().length?$(".jstree-node[id='"+a+"']").next().attr("id"):$(".jstree-node[id='"+a+"']").prev().length?$(".jstree-node[id='"+a+"']").prev().attr("id"):$(".jstree-node[id='"+a+"']").parent().parent().hasClass("jstree-node")?$(".jstree-node[id='"+a+"']").parent().parent().attr("id"):0;$("#js-tree-menu").jstree().delete_node(n),q=parseInt(b.is_key_active),p=parseInt(b.folders),$("#current-folder").text(p),$("#ttl-fldr").text(10),$(".sticky-folders .sticky-folder-"+n).remove(),ae(),$(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),V(),T(),t==n&&$(".header-posts").trigger("click"),0!=c&&$("#"+c+"_anchor").length?$("#"+c+"_anchor").trigger("click"):$(".header-posts").trigger("click")}else $(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(b.message),$("#error-folder-popup").show()}})}),$(document).on("click","#sort-order-list",function(a){a.stopPropagation(),$(".folder-order").toggleClass("active")}),$(document).on("click","#expand-collapse-list",function(b){b.stopPropagation();var a=0;$(this).hasClass("all-open")?($(this).removeClass("all-open"),a=0,$(this).attr("data-folder-tooltip","Expand"),$("#js-tree-menu").jstree("close_all")):($(this).addClass("all-open"),a=1,$(this).attr("data-folder-tooltip","Collapse"),$("#js-tree-menu").jstree("open_all")),u="",$("#js-tree-menu .jstree-node:not(.jstree-leaf)").each(function(){u+=$(this).attr("id")+","}),""!=u&&($(".form-loader-count").css("width","100%"),r=folders_media_options.nonce,$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_change_all_status&status="+a+"&folders="+u+"&nonce="+r,method:"post",success:function(a){$(".form-loader-count").css("width","0"),"0"==(a=$.parseJSON(a)).status&&($(".folder-popup-form").hide(),$(".folder-popup-form").removeClass("disabled"),$("#error-folder-popup-message").html(a.message),$("#error-folder-popup").show(),window.location.reload(!0),$(".folder-modal .jstree-anchor.jstree-clicked").length&&$(".folder-modal .jstree-anchor.jstree-clicked").trigger("focus"))}}))}),$(document).on("click",".folder-sort-menu a:not(.pro-feature)",function(a){a.stopPropagation(),a.preventDefault(),$(".form-loader-count").css("width","100%"),$(".folder-order").removeClass("active"),A=$(this).attr("data-sort"),$.ajax({url:folders_media_options.ajax_url,data:"type="+folders_media_options.post_type+"&action=wcp_folders_by_order&nonce="+folders_media_options.nonce+"&order="+$(this).attr("data-sort"),method:"post",success:function(a){1==(a=$.parseJSON(a)).status&&($("#js-tree-menu").jstree().destroy(),$("#js-tree-menu").append("<ul></ul>"),$("#js-tree-menu ul").html(a.data),C=a.terms,X(),O()),$(".form-loader-count").css("width","0")}})}),$(document).on("change","#media-attachment-taxonomy-filter",function(a){$("#js-tree-menu").hasClass("jstree")&&$("#js-tree-menu").jstree(!0).deselect_all(),$(".active-item").removeClass("active-item"),"all"==$(this).val()?$(".all-posts").addClass("active-item"):"unassigned"==$(this).val()?$(".un-categorised-items").addClass("active-item"):$("#js-tree-menu").jstree("select_node",$(this).val())}),$(document).on("click",".jstree-node .jstree-icon",function(){m=$(this).closest("li.jstree-node").attr("id"),folderStatus=$("li.jstree-node[id='"+m+"']").hasClass("jstree-open")?1:0,$(".form-loader-count").css("width","100%"),r=R(m,"nonce"),ac(),$.ajax({url:folders_media_options.ajax_url,data:"is_active="+folderStatus+"&action=save_wcp_folder_state&term_id="+m+"&nonce="+r,method:"post",success:function(a){$(".form-loader-count").css("width","0"),"0"==(a=$.parseJSON(a)).status||($("#wcp_folder_"+m).hasClass("active")?($("#wcp_folder_"+m).removeClass("active"),$("#wcp_folder_"+m).find("ul.ui-sortable:first-child > li").slideUp(),folderStatus=0):($("#wcp_folder_"+m).addClass("active"),$("#wcp_folder_"+m).find("ul.ui-sortable:first-child > li").slideDown(),folderStatus=1),ae())}})}),$(document).on("keyup","#folder-search",function(){Y()}),$(document).on("change","#folder-search",function(){Y()}),$(document).on("blur","#folder-search",function(){Y()}),$(document).on("click","#do_not_show_again",function(){var a=$(this).is(":checked")?1:0;$.ajax({url:folders_media_options.ajax_url,type:"post",data:{action:"premio_hide_child_popup",status:a,nonce:folders_media_options.nonce,post_type:folders_media_options.post_type}})}),$(document).on("click","#menu-checkbox",function(){$(this).is(":checked")?($("#js-tree-menu").addClass("show-folder-checkbox"),$("#menu-checkbox").prop("checked",!0)):($("#js-tree-menu input.checkbox").attr("checked",!1),$("#js-tree-menu").removeClass("show-folder-checkbox"),$("#menu-checkbox").prop("checked",!1))}),$(document).on("click","#menu-checkbox",function(){$(this).is(":checked")?($("#menu-checkbox").prop("checked",!0),$("#js-tree-menu").addClass("show-folder-checkbox")):($("#menu-checkbox").prop("checked",!1),$("#js-tree-menu input.checkbox").attr("checked",!1),$("#js-tree-menu").removeClass("show-folder-checkbox"))}),$(document).on("click",".folder-checkbox, .input-checkbox",function(a){a.stopImmediatePropagation(),a.stopPropagation()}),$(document).on("click","#inline-remove, .delete-folder-action:not(.disabled)",function(){$("#js-tree-menu a.jstree-clicked").length?(n=$("#js-tree-menu a.jstree-clicked").closest("li.jstree-node").attr("id"),Z(1),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu")):$("#menu-checkbox").is(":checked")&&($(".dynamic-menu").remove(),Z(1))}),$(document).on("change",".folder_for_media",function(){"add-folder"==$(this).val()&&(w=!0,$("#add-new-folder").trigger("click"))}),$(document).on("click","#js-tree-menu input.checkbox",function(){M()}),N(),$(document).on("click",".undo-button, .undo-folder-action:not(.disabled)",function(){$("#do-undo").removeClass("active"),"yes"==folders_media_options.useFolderUndo&&$.ajax({url:folders_media_options.ajax_url,type:"post",data:{post_type:folders_media_options.post_type,nonce:folders_media_options.nonce,action:"wcp_undo_folder_changes"},success:function(b){if($("#undo-done").addClass("active"),setTimeout(function(){$("#undo-done").removeClass("active")},2500),$("#media-attachment-taxonomy-filter").length){var a=parent.wp;f!=a.media&&(a.media.frame.setState("insert"),null!==a.media.frame.content.get()&& void 0!==a.media.frame.content.get().collection?(a.media.frame.content.get().collection.props.set({ignore:+new Date}),a.media.frame.content.get().options.selection.reset()):a.media.frame.library.props.set({ignore:+new Date}))}V()}})}),$(document).on("click",".close-undo-box",function(a){a.preventDefault(),$("#do-undo").removeClass("active")})}),$(document).ready(function(){"yes"==folders_media_options.use_shortcuts&&($(document).on("click",".view-shortcodes",function(a){a.preventDefault(),$("#keyboard-shortcut").show()}),$(document).keydown(function(a){var e=!!a.ctrlKey||!!a.metaKey;if(!($("input").is(":focus")||$("textarea").is(":focus"))&&a.shiftKey&&(78==a.keyCode||78==a.which)&&(a.preventDefault(),$("#add-new-folder").trigger("click")),(113==a.keyCode||113==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(n=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),console.log("fileFolderID: "+n),aa(),$(".dynamic-menu").remove()),e&&(67==a.keyCode||67==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(isFolderCopy=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),CPCAction="copy",$(".folders-undo-notification").removeClass("active"),$("#copy-message").addClass("active"),setTimeout(function(){$("#copy-message").removeClass("active")},5e3),M()),e&&(88==a.keyCode||88==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(a.preventDefault(),isFolderCopy=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),CPCAction="cut",$(".folders-undo-notification").removeClass("active"),$("#cut-message").addClass("active"),setTimeout(function(){$("#cut-message").removeClass("active")},5e3),M()),e&&(86==a.keyCode||86==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&(a.preventDefault(),(""==(t=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"))||isNaN(t))&&(t=0),0!=isFolderCopy&&""!=isFolderCopy&&isFolderCopy!=t&&("cut"==CPCAction?(lastParentID=$("#"+isFolderCopy).data("parent"),lastCopiedFolder=isFolderCopy,lastFolderOrder=$("#"+isFolderCopy).index()+1,""!=t&&0!=t?$("#js-tree-menu").jstree("move_node","#"+isFolderCopy,"#"+t,0):$("#js-tree-menu").jstree("move_node","#"+isFolderCopy,"#",$("#js-tree-menu > ul > li.jstree-node").length),$(".folders-undo-notification").removeClass("active"),$("#paste-message").addClass("active"),setTimeout(function(){$("#paste-message").removeClass("active")},5e3)):((""==t||isNaN(t))&&(t=0),copyFolders(isFolderCopy,t)),M(),CPCAction="",isFolderCopy=0)),e&&(75==a.keyCode||75==a.which)&&$("#keyboard-shortcut").show(),e&&(40==a.keyCode||40==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){n=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");var b=parseInt($(".folder-modal #"+n).data("parent")),c=parseInt($(".folder-modal #"+n).index())+1,d=parseInt($(".folder-modal #"+n).data("child"));isNaN(b)&&(b=$(".folder-modal li#"+n).parents("li.jstree-node").length?$(".folder-modal li#"+n).parents("li.jstree-node").data("folder"):0,d=$(".folder-modal li#"+n).parents("li.jstree-node").length?$(".folder-modal li#"+n).parents("li.jstree-node").children():$(".folder-modal #js-tree-menu > ul > li").length),0==b&&(b=""),d==c?$(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+b,0):$(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+b,c+1)}if(e&&(38==a.keyCode||38==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){n=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");var b=parseInt($(".folder-modal #"+n).data("parent")),c=parseInt($(".folder-modal #"+n).index())-1,d=parseInt($(".folder-modal #"+n).data("child"));isNaN(b)&&(c=parseInt($("#"+n).index())-1,b=$(".folder-modal li#"+n).parents("li.jstree-node").length?$(".folder-modal li#"+n).parents("li.jstree-node").data("folder"):0,d=$(".folder-modal li#"+n).parents("li.jstree-node").length?$(".folder-modal li#"+n).parents("li.jstree-node").children():$(".folder-modal #js-tree-menu > ul > li").length),0==b&&(b=""),-1==c?$(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+b,d):$(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+b,c)}if((46==a.keyCode||46==a.which||8==a.keyCode||8==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")&&($(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").hasClass("is-locked")||(n=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id"),Z(0),$(".dynamic-menu").remove(),$(".active-menu").removeClass("active-menu"))),e&&(40==a.keyCode||40==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){n=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");var b=parseInt($("#"+n).data("parent")),c=parseInt($("#"+n).index())+1,d=parseInt($("#"+n).data("child"));0==b&&(b=""),d==c?$(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+b,0):$(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+b,c+1)}if(e&&(38==a.keyCode||38==a.which)&&$(".folder-modal #js-tree-menu .jstree-anchor").is(":focus")){n=$(".folder-modal #js-tree-menu .jstree-anchor:focus").closest("li.jstree-node").attr("id");var b=parseInt($("#"+n).data("parent")),c=parseInt($("#"+n).index())-1,d=parseInt($("#"+n).data("child"));0==b&&(b=""),-1==c?$(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+b,d):$(".folder-modal #js-tree-menu").jstree("move_node","#"+n,"#"+b,c)}(27==a.keyCode||27==a.which)&&($(".folder-popup-form").hide(),$(".jstree-node[id='"+n+"']").length?$(".jstree-node[id='"+n+"'] > a.jstree-anchor").trigger("focus"):$("#js-tree-menu .jstree-anchor.jstree-clicked").length&&$("#js-tree-menu .jstree-anchor.jstree-clicked").trigger("focus"))}))})})